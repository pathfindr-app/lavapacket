<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAVA Roofing - Inspection Checklist</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --lava-red: #c41e3a;
            --lava-dark: #1a1a1a;
            --lava-gray: #2d2d2d;
            --lava-light: #f5f5f5;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--lava-light);
            color: var(--lava-dark);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--lava-dark);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--lava-red);
            letter-spacing: 2px;
        }

        .logo span {
            color: white;
        }

        .header-nav {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid #555;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--lava-red);
            border-color: var(--lava-red);
        }

        /* Main Container */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* View Toggle */
        .view-form { display: block; }
        .view-list { display: none; }
        .view-recap { display: none; }

        body.show-list .view-form { display: none; }
        body.show-list .view-list { display: block; }
        body.show-recap .view-form { display: none; }
        body.show-recap .view-recap { display: block; }

        /* Accordion Sections */
        .section {
            background: white;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: var(--lava-gray);
            color: white;
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .section-header h2 {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-header .status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            background: #555;
        }

        .section-header .status.complete {
            background: var(--success);
        }

        .section-header .chevron {
            transition: transform 0.3s;
        }

        .section.open .section-header .chevron {
            transform: rotate(180deg);
        }

        .section-content {
            display: none;
            padding: 1rem;
        }

        .section.open .section-content {
            display: block;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        label .required {
            color: var(--lava-red);
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--lava-red);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select {
            background: white;
            cursor: pointer;
        }

        /* Radio/Checkbox Groups */
        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .option-btn {
            flex: 1;
            min-width: calc(50% - 0.25rem);
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: var(--lava-red);
        }

        .option-btn.selected {
            border-color: var(--lava-red);
            background: var(--lava-red);
            color: white;
        }

        .option-btn.good.selected { background: var(--success); border-color: var(--success); }
        .option-btn.fair.selected { background: var(--warning); border-color: var(--warning); color: var(--lava-dark); }
        .option-btn.poor.selected { background: var(--danger); border-color: var(--danger); }
        .option-btn.critical.selected { background: #721c24; border-color: #721c24; }
        .option-btn.na.selected { background: #6c757d; border-color: #6c757d; }

        /* Checkbox Items */
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--lava-light);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .checkbox-item.checked {
            background: #d4edda;
        }

        /* Photo Section */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-upload {
            aspect-ratio: 4/3;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--lava-light);
            position: relative;
            overflow: hidden;
        }

        .photo-upload:hover {
            border-color: var(--lava-red);
            background: #fff;
        }

        .photo-upload.has-photo {
            border-style: solid;
            border-color: var(--success);
        }

        .photo-upload img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-upload .placeholder {
            text-align: center;
            color: #888;
            font-size: 0.85rem;
        }

        .photo-upload .placeholder svg {
            width: 32px;
            height: 32px;
            margin-bottom: 0.5rem;
            fill: #888;
        }

        .photo-upload input[type="file"] {
            display: none;
        }

        .photo-upload .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 28px;
            height: 28px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
            z-index: 10;
        }

        .photo-caption {
            margin-top: 0.5rem;
        }

        .photo-caption input {
            font-size: 0.85rem;
            padding: 0.5rem;
        }

        /* Additional Photos */
        .add-photo-btn {
            width: 100%;
            padding: 1rem;
            border: 2px dashed var(--lava-red);
            border-radius: 8px;
            background: transparent;
            color: var(--lava-red);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.2s;
        }

        .add-photo-btn:hover {
            background: var(--lava-red);
            color: white;
        }

        /* Action Buttons */
        .actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1rem;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 0.5rem;
            margin: 1rem -1rem -1rem;
        }

        .btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--lava-red);
            color: white;
        }

        .btn-primary:hover {
            background: #a01830;
        }

        .btn-secondary {
            background: var(--lava-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: #1a1a1a;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* Saved Inspections List */
        .inspection-list {
            list-style: none;
        }

        .inspection-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
        }

        .inspection-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .inspection-item h3 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .inspection-item .meta {
            font-size: 0.85rem;
            color: #666;
        }

        .inspection-item .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.draft { background: var(--warning); color: var(--lava-dark); }
        .status-badge.complete { background: var(--success); color: white; }
        .status-badge.sent { background: var(--info); color: white; }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #888;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            fill: #ccc;
        }

        /* Recap View */
        .recap-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .recap-header {
            background: var(--lava-dark);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .recap-header .logo {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .recap-header h1 {
            font-size: 1.25rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .recap-body {
            padding: 1.5rem;
        }

        .recap-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .recap-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .recap-section h2 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--lava-red);
            margin-bottom: 0.75rem;
        }

        .recap-section p {
            color: #444;
        }

        .recap-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .recap-meta dt {
            color: #888;
        }

        .recap-meta dd {
            font-weight: 500;
        }

        .recap-photos {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .recap-photo {
            aspect-ratio: 4/3;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
        }

        .recap-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recap-footer {
            background: var(--lava-light);
            padding: 1.5rem;
            text-align: center;
        }

        .recap-footer .tagline {
            font-style: italic;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .recap-footer .contact {
            font-size: 0.9rem;
            color: #888;
        }

        .recap-actions {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--lava-light);
        }

        /* Photo Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal img {
            max-width: 95%;
            max-height: 90vh;
            object-fit: contain;
        }

        .modal .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--lava-dark);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .toast.show {
            opacity: 1;
        }

        /* Print Styles */
        @media print {
            .header, .actions, .recap-actions, .nav-btn {
                display: none !important;
            }

            .container {
                max-width: none;
                padding: 0;
            }

            .recap-container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo"><img src="logo.png" alt="LAVA Roofing" style="height: 40px;"></div>
            <nav class="header-nav">
                <button class="nav-btn active" onclick="showView('form')">New</button>
                <button class="nav-btn" onclick="showView('list')">Saved</button>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- FORM VIEW -->
        <div class="view-form">
            <form id="inspectionForm">
                <!-- Section 1: Customer Info -->
                <div class="section open" data-section="customer">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>1</span> Customer Info
                        </h2>
                        <span class="status">Required</span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Customer Name <span class="required">*</span></label>
                            <input type="text" name="customerName" required>
                        </div>
                        <div class="form-group">
                            <label>Property Address <span class="required">*</span></label>
                            <input type="text" name="address" required>
                        </div>
                        <div class="form-group">
                            <label>Phone <span class="required">*</span></label>
                            <input type="tel" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Inspection Date</label>
                            <input type="date" name="inspectionDate">
                        </div>
                        <div class="form-group">
                            <label>Inspector Name</label>
                            <input type="text" name="inspectorName" placeholder="Your name">
                        </div>
                    </div>
                </div>

                <!-- Section 2: Customer's Concerns -->
                <div class="section" data-section="concerns">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>2</span> Customer's Concerns
                        </h2>
                        <span class="status"></span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>What brought us out today?</label>
                            <textarea name="mainConcern" placeholder="Describe what the customer is experiencing..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>How long has this been happening?</label>
                            <input type="text" name="issueDuration" placeholder="e.g., 2 weeks, since last storm">
                        </div>
                        <div class="form-group">
                            <label>Any previous roof work?</label>
                            <div class="option-group" data-field="previousWork">
                                <button type="button" class="option-btn" data-value="yes">Yes</button>
                                <button type="button" class="option-btn" data-value="no">No</button>
                                <button type="button" class="option-btn" data-value="unknown">Unknown</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Previous work details</label>
                            <input type="text" name="previousWorkDetails" placeholder="What was done and when?">
                        </div>
                        <div class="form-group">
                            <label>Customer's urgency</label>
                            <div class="option-group" data-field="customerUrgency">
                                <button type="button" class="option-btn" data-value="urgent">Urgent</button>
                                <button type="button" class="option-btn" data-value="soon">Soon</button>
                                <button type="button" class="option-btn" data-value="planning">Planning Ahead</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Roof Overview -->
                <div class="section" data-section="roof">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>3</span> Roof Overview
                        </h2>
                        <span class="status"></span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Roof Type</label>
                            <select name="roofType">
                                <option value="">Select...</option>
                                <option value="asphalt-shingle">Asphalt Shingle</option>
                                <option value="tile">Tile</option>
                                <option value="metal-standing-seam">Metal - Standing Seam</option>
                                <option value="metal-corrugated">Metal - Corrugated</option>
                                <option value="flat-lowslope">Flat / Low-Slope</option>
                                <option value="wood-shake">Wood Shake</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Estimated Roof Age</label>
                            <select name="roofAge">
                                <option value="">Select...</option>
                                <option value="0-5">0-5 years</option>
                                <option value="5-10">5-10 years</option>
                                <option value="10-15">10-15 years</option>
                                <option value="15-20">15-20 years</option>
                                <option value="20-25">20-25 years</option>
                                <option value="25-30">25-30 years</option>
                                <option value="30+">30+ years</option>
                                <option value="unknown">Unknown</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Stories</label>
                            <div class="option-group" data-field="stories">
                                <button type="button" class="option-btn" data-value="1">1</button>
                                <button type="button" class="option-btn" data-value="2">2</button>
                                <button type="button" class="option-btn" data-value="3+">3+</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Pitch</label>
                            <div class="option-group" data-field="pitch">
                                <button type="button" class="option-btn" data-value="flat">Flat</button>
                                <button type="button" class="option-btn" data-value="low">Low (1-3/12)</button>
                                <button type="button" class="option-btn" data-value="medium">Medium (4-6/12)</button>
                                <button type="button" class="option-btn" data-value="steep">Steep (7+/12)</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Overall Condition</label>
                            <div class="option-group" data-field="overallCondition">
                                <button type="button" class="option-btn good" data-value="good">Good</button>
                                <button type="button" class="option-btn fair" data-value="fair">Fair</button>
                                <button type="button" class="option-btn poor" data-value="poor">Poor</button>
                                <button type="button" class="option-btn critical" data-value="critical">Critical</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Inspection Findings -->
                <div class="section" data-section="findings">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>4</span> Inspection Findings
                        </h2>
                        <span class="status"></span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Problem Areas Identified</label>
                            <textarea name="problemAreas" placeholder="Describe location and nature of issues found..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Diagnosis - What's causing the issue?</label>
                            <textarea name="diagnosis" placeholder="Root cause analysis..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Gutters / Drainage</label>
                            <div class="option-group" data-field="gutters">
                                <button type="button" class="option-btn good" data-value="good">Good</button>
                                <button type="button" class="option-btn fair" data-value="fair">Fair</button>
                                <button type="button" class="option-btn poor" data-value="poor">Poor</button>
                                <button type="button" class="option-btn na" data-value="na">N/A</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Flashing Condition</label>
                            <div class="option-group" data-field="flashing">
                                <button type="button" class="option-btn good" data-value="good">Good</button>
                                <button type="button" class="option-btn fair" data-value="fair">Fair</button>
                                <button type="button" class="option-btn poor" data-value="poor">Poor</button>
                                <button type="button" class="option-btn na" data-value="na">N/A</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Vents / Penetrations</label>
                            <div class="option-group" data-field="vents">
                                <button type="button" class="option-btn good" data-value="good">Good</button>
                                <button type="button" class="option-btn fair" data-value="fair">Fair</button>
                                <button type="button" class="option-btn poor" data-value="poor">Poor</button>
                                <button type="button" class="option-btn na" data-value="na">N/A</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Additional Issues Found</label>
                            <textarea name="additionalIssues" placeholder="Any other observations..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Photos -->
                <div class="section" data-section="photos">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>5</span> Photos
                        </h2>
                        <span class="status" id="photoCount">0 photos</span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">Tap to capture photos. They'll be included in the customer recap.</p>

                        <div class="photo-grid" id="photoGrid">
                            <div class="photo-upload" data-category="overview" onclick="this.querySelector('input').click()">
                                <div class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>
                                    <div>Roof Overview</div>
                                </div>
                                <input type="file" accept="image/*"  onchange="handlePhoto(this, 'overview')">
                            </div>
                            <div class="photo-upload" data-category="problem" onclick="this.querySelector('input').click()">
                                <div class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                                    <div>Problem Area</div>
                                </div>
                                <input type="file" accept="image/*"  onchange="handlePhoto(this, 'problem')">
                            </div>
                            <div class="photo-upload" data-category="additional" onclick="this.querySelector('input').click()">
                                <div class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                    <div>Additional</div>
                                </div>
                                <input type="file" accept="image/*"  onchange="handlePhoto(this, 'additional')">
                            </div>
                            <div class="photo-upload" data-category="interior" onclick="this.querySelector('input').click()">
                                <div class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                                    <div>Interior</div>
                                </div>
                                <input type="file" accept="image/*"  onchange="handlePhoto(this, 'interior')">
                            </div>
                        </div>

                        <div id="additionalPhotos"></div>

                        <button type="button" class="add-photo-btn" onclick="addPhotoSlot()">+ Add Another Photo</button>
                    </div>
                </div>

                <!-- Section 6: Recommendation -->
                <div class="section" data-section="recommendation">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>6</span> Recommendation
                        </h2>
                        <span class="status"></span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label>Recommendation</label>
                            <div class="option-group" data-field="recommendation">
                                <button type="button" class="option-btn" data-value="repair">Repair</button>
                                <button type="button" class="option-btn" data-value="partial">Partial Replace</button>
                                <button type="button" class="option-btn" data-value="full">Full Replace</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Urgency</label>
                            <div class="option-group" data-field="urgency">
                                <button type="button" class="option-btn" data-value="immediate">Immediate</button>
                                <button type="button" class="option-btn" data-value="30days">Within 30 Days</button>
                                <button type="button" class="option-btn" data-value="plan">Can Plan Ahead</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Summary for Customer</label>
                            <textarea name="customerSummary" placeholder="What you want to tell the customer (this goes on the recap)..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Internal Notes (not shared)</label>
                            <textarea name="internalNotes" placeholder="Notes for yourself/team only..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Section 7: Wrap-up -->
                <div class="section" data-section="wrapup">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h2>
                            <span>7</span> Wrap-up Checklist
                        </h2>
                        <span class="status" id="wrapupStatus">0/4</span>
                        <svg class="chevron" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="section-content">
                        <div class="checkbox-item" onclick="toggleCheckbox(event, this)">
                            <input type="checkbox" name="wrapup_walked">
                            <span>Walked customer through findings</span>
                        </div>
                        <div class="checkbox-item" onclick="toggleCheckbox(event, this)">
                            <input type="checkbox" name="wrapup_explained">
                            <span>Explained next steps</span>
                        </div>
                        <div class="checkbox-item" onclick="toggleCheckbox(event, this)">
                            <input type="checkbox" name="wrapup_timeline">
                            <span>Gave quote timeline</span>
                        </div>
                        <div class="checkbox-item" onclick="toggleCheckbox(event, this)">
                            <input type="checkbox" name="wrapup_thanked">
                            <span>Thanked customer</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="saveInspection()">Save</button>
                    <button type="button" class="btn btn-primary" onclick="generateRecap()">Generate Recap</button>
                </div>
            </form>
        </div>

        <!-- LIST VIEW -->
        <div class="view-list">
            <h2 style="margin-bottom: 1rem;">Saved Inspections</h2>
            <ul class="inspection-list" id="inspectionList">
                <!-- Populated by JS -->
            </ul>
            <div class="empty-state" id="emptyState">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg>
                <p>No saved inspections yet.<br>Start a new inspection to get going!</p>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="startNewInspection()">Start New Inspection</button>
            </div>
        </div>

        <!-- RECAP VIEW -->
        <div class="view-recap">
            <div class="recap-actions">
                <button class="btn btn-secondary" onclick="showView('form')">Back to Edit</button>
                <button class="btn btn-primary" onclick="shareRecap('email')">Email to Customer</button>
            </div>
            <div class="recap-container" id="recapContent">
                <!-- Populated by JS -->
            </div>
            <div class="recap-actions">
                <button class="btn btn-secondary" onclick="shareRecap('print')">Print / Save PDF</button>
                <button class="btn btn-secondary" onclick="shareRecap('copy')">Copy Link</button>
            </div>
        </div>
    </main>

    <!-- Photo Modal -->
    <div class="modal" id="photoModal" onclick="closeModal()">
        <button class="close-btn" onclick="closeModal()">&times;</button>
        <img id="modalImage" src="" alt="Full size photo">
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // State
        let currentInspection = null;
        let photos = [];
        let additionalPhotoCount = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date
            document.querySelector('input[name="inspectionDate"]').valueAsDate = new Date();

            // Load saved inspector name
            const settings = JSON.parse(localStorage.getItem('lava_settings') || '{}');
            if (settings.inspectorName) {
                document.querySelector('input[name="inspectorName"]').value = settings.inspectorName;
            }

            // Setup option buttons
            document.querySelectorAll('.option-group').forEach(group => {
                group.querySelectorAll('.option-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        group.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            });

            // Auto-save on input change
            document.querySelectorAll('input, textarea, select').forEach(el => {
                el.addEventListener('change', autoSave);
            });

            // Load inspections list
            loadInspectionList();
        });

        // View switching
        function showView(view) {
            document.body.classList.remove('show-list', 'show-recap');
            if (view === 'list') {
                document.body.classList.add('show-list');
                loadInspectionList();
            } else if (view === 'recap') {
                document.body.classList.add('show-recap');
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (view === 'form') document.querySelectorAll('.nav-btn')[0].classList.add('active');
            if (view === 'list') document.querySelectorAll('.nav-btn')[1].classList.add('active');
        }

        // Section toggle
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('open');
        }

        // Checkbox toggle
        function toggleCheckbox(event, label) {
            event.preventDefault();
            const checkbox = label.querySelector('input');
            checkbox.checked = !checkbox.checked;
            label.classList.toggle('checked', checkbox.checked);
            updateWrapupStatus();
        }

        function updateWrapupStatus() {
            const checked = document.querySelectorAll('.section[data-section="wrapup"] input:checked').length;
            document.getElementById('wrapupStatus').textContent = `${checked}/4`;
            if (checked === 4) {
                document.getElementById('wrapupStatus').classList.add('complete');
            } else {
                document.getElementById('wrapupStatus').classList.remove('complete');
            }
        }

        // Photo handling
        function handlePhoto(input, category) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                // Compress image
                compressImage(e.target.result, function(compressedData) {
                    const photoBox = input.parentElement;

                    // Check if we're updating existing or adding new
                    const existingIndex = photos.findIndex(p => p.element === photoBox);
                    if (existingIndex >= 0) {
                        photos[existingIndex].dataUrl = compressedData;
                    } else {
                        photos.push({
                            id: Date.now().toString(),
                            category: category,
                            dataUrl: compressedData,
                            caption: '',
                            element: photoBox
                        });
                    }

                    // Update UI
                    photoBox.classList.add('has-photo');

                    // Remove placeholder, add image
                    const placeholder = photoBox.querySelector('.placeholder');
                    if (placeholder) placeholder.style.display = 'none';

                    let img = photoBox.querySelector('img');
                    if (!img) {
                        img = document.createElement('img');
                        img.onclick = function(e) {
                            e.stopPropagation();
                            openModal(compressedData);
                        };
                        photoBox.insertBefore(img, photoBox.firstChild);
                    }
                    img.src = compressedData;

                    // Add remove button
                    if (!photoBox.querySelector('.remove-btn')) {
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '&times;';
                        removeBtn.onclick = function(e) {
                            e.stopPropagation();
                            removePhoto(photoBox);
                        };
                        photoBox.appendChild(removeBtn);
                    }

                    updatePhotoCount();
                    autoSave();
                });
            };
            reader.readAsDataURL(file);
        }

        function compressImage(dataUrl, callback) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const maxSize = 1200;
                let width = img.width;
                let height = img.height;

                if (width > height && width > maxSize) {
                    height = (height * maxSize) / width;
                    width = maxSize;
                } else if (height > maxSize) {
                    width = (width * maxSize) / height;
                    height = maxSize;
                }

                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                callback(canvas.toDataURL('image/jpeg', 0.7));
            };
            img.src = dataUrl;
        }

        function removePhoto(photoBox) {
            const index = photos.findIndex(p => p.element === photoBox);
            if (index >= 0) {
                photos.splice(index, 1);
            }

            // If it's an additional photo, remove the whole element
            if (photoBox.closest('#additionalPhotos')) {
                photoBox.closest('.photo-item')?.remove() || photoBox.remove();
            } else {
                // Reset to placeholder
                photoBox.classList.remove('has-photo');
                const img = photoBox.querySelector('img');
                if (img) img.remove();
                const removeBtn = photoBox.querySelector('.remove-btn');
                if (removeBtn) removeBtn.remove();
                const placeholder = photoBox.querySelector('.placeholder');
                if (placeholder) placeholder.style.display = '';
                photoBox.querySelector('input').value = '';
            }

            updatePhotoCount();
            autoSave();
        }

        function addPhotoSlot() {
            additionalPhotoCount++;
            const container = document.getElementById('additionalPhotos');
            const div = document.createElement('div');
            div.className = 'photo-item';
            div.style.marginTop = '1rem';
            div.innerHTML = `
                <div class="photo-upload" data-category="extra${additionalPhotoCount}" onclick="this.querySelector('input').click()">
                    <div class="placeholder">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                        <div>Extra Photo ${additionalPhotoCount}</div>
                    </div>
                    <input type="file" accept="image/*"  onchange="handlePhoto(this, 'extra${additionalPhotoCount}')">
                </div>
            `;
            container.appendChild(div);

            // Trigger the file input
            div.querySelector('input').click();
        }

        function updatePhotoCount() {
            const count = photos.length;
            document.getElementById('photoCount').textContent = `${count} photo${count !== 1 ? 's' : ''}`;
        }

        // Modal
        function openModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('photoModal').classList.add('open');
        }

        function closeModal() {
            document.getElementById('photoModal').classList.remove('open');
        }

        // Form data collection
        function getFormData() {
            const form = document.getElementById('inspectionForm');
            const data = {
                id: currentInspection?.id || Date.now().toString(),
                created: currentInspection?.created || new Date().toISOString(),
                updated: new Date().toISOString(),
                status: 'draft',
                customer: {
                    name: form.customerName.value,
                    address: form.address.value,
                    phone: form.phone.value,
                    email: form.email.value
                },
                inspectionDate: form.inspectionDate.value,
                inspectorName: form.inspectorName.value,
                concerns: {
                    mainConcern: form.mainConcern.value,
                    duration: form.issueDuration.value,
                    previousWork: getSelectedOption('previousWork'),
                    previousWorkDetails: form.previousWorkDetails.value,
                    customerUrgency: getSelectedOption('customerUrgency')
                },
                roof: {
                    type: form.roofType.value,
                    age: form.roofAge.value,
                    stories: getSelectedOption('stories'),
                    pitch: getSelectedOption('pitch'),
                    condition: getSelectedOption('overallCondition')
                },
                findings: {
                    problemAreas: form.problemAreas.value,
                    diagnosis: form.diagnosis.value,
                    gutters: getSelectedOption('gutters'),
                    flashing: getSelectedOption('flashing'),
                    vents: getSelectedOption('vents'),
                    additionalIssues: form.additionalIssues.value
                },
                photos: photos.map(p => ({
                    id: p.id,
                    category: p.category,
                    dataUrl: p.dataUrl,
                    caption: p.caption
                })),
                recommendation: {
                    type: getSelectedOption('recommendation'),
                    urgency: getSelectedOption('urgency'),
                    customerSummary: form.customerSummary.value,
                    internalNotes: form.internalNotes.value
                },
                wrapup: {
                    walked: form.wrapup_walked.checked,
                    explained: form.wrapup_explained.checked,
                    timeline: form.wrapup_timeline.checked,
                    thanked: form.wrapup_thanked.checked
                }
            };
            return data;
        }

        function getSelectedOption(field) {
            const selected = document.querySelector(`.option-group[data-field="${field}"] .option-btn.selected`);
            return selected ? selected.dataset.value : '';
        }

        // Save
        function saveInspection() {
            const data = getFormData();

            // Save inspector name preference
            if (data.inspectorName) {
                localStorage.setItem('lava_settings', JSON.stringify({ inspectorName: data.inspectorName }));
            }

            // Get existing inspections
            const inspections = JSON.parse(localStorage.getItem('lava_inspections') || '[]');

            // Update or add
            const existingIndex = inspections.findIndex(i => i.id === data.id);
            if (existingIndex >= 0) {
                inspections[existingIndex] = data;
            } else {
                inspections.unshift(data);
            }

            localStorage.setItem('lava_inspections', JSON.stringify(inspections));
            currentInspection = data;

            showToast('Inspection saved!');
        }

        function autoSave() {
            // Debounced auto-save
            clearTimeout(window.autoSaveTimeout);
            window.autoSaveTimeout = setTimeout(() => {
                if (document.querySelector('input[name="customerName"]').value) {
                    saveInspection();
                }
            }, 2000);
        }

        // Load inspections list
        function loadInspectionList() {
            const inspections = JSON.parse(localStorage.getItem('lava_inspections') || '[]');
            const list = document.getElementById('inspectionList');
            const emptyState = document.getElementById('emptyState');

            if (inspections.length === 0) {
                list.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            list.innerHTML = inspections.map(i => `
                <li class="inspection-item" onclick="loadInspection('${i.id}')">
                    <h3>${i.customer.name || 'Unnamed'}</h3>
                    <div class="meta">${i.customer.address || 'No address'}</div>
                    <div class="meta">${formatDate(i.inspectionDate || i.created)}</div>
                    <span class="status-badge ${i.status}">${i.status}</span>
                </li>
            `).join('');
        }

        function loadInspection(id) {
            const inspections = JSON.parse(localStorage.getItem('lava_inspections') || '[]');
            const inspection = inspections.find(i => i.id === id);
            if (!inspection) return;

            currentInspection = inspection;

            // Populate form
            const form = document.getElementById('inspectionForm');
            form.customerName.value = inspection.customer.name || '';
            form.address.value = inspection.customer.address || '';
            form.phone.value = inspection.customer.phone || '';
            form.email.value = inspection.customer.email || '';
            form.inspectionDate.value = inspection.inspectionDate || '';
            form.inspectorName.value = inspection.inspectorName || '';

            form.mainConcern.value = inspection.concerns?.mainConcern || '';
            form.issueDuration.value = inspection.concerns?.duration || '';
            setSelectedOption('previousWork', inspection.concerns?.previousWork);
            form.previousWorkDetails.value = inspection.concerns?.previousWorkDetails || '';
            setSelectedOption('customerUrgency', inspection.concerns?.customerUrgency);

            form.roofType.value = inspection.roof?.type || '';
            form.roofAge.value = inspection.roof?.age || '';
            setSelectedOption('stories', inspection.roof?.stories);
            setSelectedOption('pitch', inspection.roof?.pitch);
            setSelectedOption('overallCondition', inspection.roof?.condition);

            form.problemAreas.value = inspection.findings?.problemAreas || '';
            form.diagnosis.value = inspection.findings?.diagnosis || '';
            setSelectedOption('gutters', inspection.findings?.gutters);
            setSelectedOption('flashing', inspection.findings?.flashing);
            setSelectedOption('vents', inspection.findings?.vents);
            form.additionalIssues.value = inspection.findings?.additionalIssues || '';

            setSelectedOption('recommendation', inspection.recommendation?.type);
            setSelectedOption('urgency', inspection.recommendation?.urgency);
            form.customerSummary.value = inspection.recommendation?.customerSummary || '';
            form.internalNotes.value = inspection.recommendation?.internalNotes || '';

            form.wrapup_walked.checked = inspection.wrapup?.walked || false;
            form.wrapup_explained.checked = inspection.wrapup?.explained || false;
            form.wrapup_timeline.checked = inspection.wrapup?.timeline || false;
            form.wrapup_thanked.checked = inspection.wrapup?.thanked || false;

            // Update checkbox styling
            document.querySelectorAll('.checkbox-item').forEach(item => {
                const checkbox = item.querySelector('input');
                item.classList.toggle('checked', checkbox.checked);
            });
            updateWrapupStatus();

            // Load photos
            photos = [];
            if (inspection.photos && inspection.photos.length > 0) {
                inspection.photos.forEach(photo => {
                    const photoBox = document.querySelector(`.photo-upload[data-category="${photo.category}"]`);
                    if (photoBox) {
                        photoBox.classList.add('has-photo');
                        const placeholder = photoBox.querySelector('.placeholder');
                        if (placeholder) placeholder.style.display = 'none';

                        let img = photoBox.querySelector('img');
                        if (!img) {
                            img = document.createElement('img');
                            img.onclick = function(e) {
                                e.stopPropagation();
                                openModal(photo.dataUrl);
                            };
                            photoBox.insertBefore(img, photoBox.firstChild);
                        }
                        img.src = photo.dataUrl;

                        if (!photoBox.querySelector('.remove-btn')) {
                            const removeBtn = document.createElement('button');
                            removeBtn.className = 'remove-btn';
                            removeBtn.innerHTML = '&times;';
                            removeBtn.onclick = function(e) {
                                e.stopPropagation();
                                removePhoto(photoBox);
                            };
                            photoBox.appendChild(removeBtn);
                        }

                        photos.push({
                            ...photo,
                            element: photoBox
                        });
                    }
                });
            }
            updatePhotoCount();

            showView('form');
        }

        function setSelectedOption(field, value) {
            if (!value) return;
            const group = document.querySelector(`.option-group[data-field="${field}"]`);
            if (group) {
                group.querySelectorAll('.option-btn').forEach(btn => {
                    btn.classList.toggle('selected', btn.dataset.value === value);
                });
            }
        }

        function startNewInspection() {
            currentInspection = null;
            document.getElementById('inspectionForm').reset();
            document.querySelector('input[name="inspectionDate"]').valueAsDate = new Date();

            // Load saved inspector name
            const settings = JSON.parse(localStorage.getItem('lava_settings') || '{}');
            if (settings.inspectorName) {
                document.querySelector('input[name="inspectorName"]').value = settings.inspectorName;
            }

            // Clear option selections
            document.querySelectorAll('.option-btn.selected').forEach(btn => btn.classList.remove('selected'));

            // Clear checkboxes
            document.querySelectorAll('.checkbox-item').forEach(item => {
                item.classList.remove('checked');
                item.querySelector('input').checked = false;
            });
            updateWrapupStatus();

            // Clear photos
            photos = [];
            document.querySelectorAll('.photo-upload').forEach(box => {
                box.classList.remove('has-photo');
                const img = box.querySelector('img');
                if (img) img.remove();
                const removeBtn = box.querySelector('.remove-btn');
                if (removeBtn) removeBtn.remove();
                const placeholder = box.querySelector('.placeholder');
                if (placeholder) placeholder.style.display = '';
                const input = box.querySelector('input');
                if (input) input.value = '';
            });
            document.getElementById('additionalPhotos').innerHTML = '';
            additionalPhotoCount = 0;
            updatePhotoCount();

            showView('form');
        }

        // Generate Recap
        function generateRecap() {
            saveInspection();
            const data = getFormData();

            const roofTypeLabels = {
                'asphalt-shingle': 'Asphalt Shingle',
                'tile': 'Tile',
                'metal-standing-seam': 'Metal Standing Seam',
                'metal-corrugated': 'Metal Corrugated',
                'flat-lowslope': 'Flat/Low-Slope',
                'wood-shake': 'Wood Shake',
                'other': 'Other'
            };

            const recommendationLabels = {
                'repair': 'Repair',
                'partial': 'Partial Replacement',
                'full': 'Full Replacement'
            };

            const urgencyLabels = {
                'immediate': 'Immediate attention recommended',
                '30days': 'Within 30 days recommended',
                'plan': 'Can plan ahead'
            };

            const photosHtml = data.photos.length > 0 ? `
                <div class="recap-section">
                    <h2>Photos</h2>
                    <div class="recap-photos">
                        ${data.photos.map(p => `
                            <div class="recap-photo" onclick="openModal('${p.dataUrl}')">
                                <img src="${p.dataUrl}" alt="${p.category}">
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : '';

            const recapHtml = `
                <div class="recap-header">
                    <img src="logo.png" alt="LAVA Roofing" style="height: 60px; margin-bottom: 0.5rem;">
                    <h1>Inspection Summary</h1>
                    <p style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.25rem;">Contractor License: CT-39063</p>
                </div>
                <div class="recap-body">
                    <div class="recap-section">
                        <dl class="recap-meta">
                            <dt>Prepared for</dt>
                            <dd>${data.customer.name}</dd>
                            <dt>Property</dt>
                            <dd>${data.customer.address}</dd>
                            <dt>Date</dt>
                            <dd>${formatDate(data.inspectionDate)}</dd>
                            <dt>Inspector</dt>
                            <dd>${data.inspectorName || 'LAVA Roofing'}</dd>
                        </dl>
                    </div>

                    ${data.concerns.mainConcern ? `
                    <div class="recap-section">
                        <h2>What You Told Us</h2>
                        <p>${data.concerns.mainConcern}</p>
                    </div>
                    ` : ''}

                    <div class="recap-section">
                        <h2>What We Found</h2>
                        <p><strong>${roofTypeLabels[data.roof.type] || data.roof.type || 'Roof'}</strong>, approximately <strong>${data.roof.age || 'unknown'} years old</strong></p>
                        <p>Overall condition: <strong>${capitalize(data.roof.condition) || 'Not assessed'}</strong></p>
                        ${data.findings.problemAreas ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 6px; border-left: 4px solid var(--lava-red);">
                            <strong style="display: block; margin-bottom: 0.5rem;">Problem Areas Identified:</strong>
                            <p style="margin: 0; white-space: pre-line;">${data.findings.problemAreas}</p>
                        </div>
                        ` : ''}
                        ${data.findings.diagnosis ? `
                        <div style="margin-top: 1rem;">
                            <strong style="display: block; margin-bottom: 0.5rem;">Diagnosis:</strong>
                            <p style="margin: 0;">${data.findings.diagnosis}</p>
                        </div>
                        ` : ''}
                    </div>

                    ${data.recommendation.type ? `
                    <div class="recap-section">
                        <h2>Our Recommendation</h2>
                        <p><strong>${recommendationLabels[data.recommendation.type] || data.recommendation.type}</strong></p>
                        ${data.recommendation.urgency ? `<p style="color: #666; font-size: 0.9rem;">${urgencyLabels[data.recommendation.urgency]}</p>` : ''}
                        ${data.recommendation.customerSummary ? `<p style="margin-top: 0.5rem;">${data.recommendation.customerSummary}</p>` : ''}
                    </div>
                    ` : ''}

                    ${photosHtml}

                    <div class="recap-section">
                        <h2>What's Next</h2>
                        <p>We're preparing a detailed quote for you. Expect it within <strong>2-3 business days</strong>.</p>
                        <p style="margin-top: 0.5rem;">Questions? Call us at <a href="tel:8082507337">(808) 250-7337</a> or email <a href="mailto:kyle@lavaroofing.com">kyle@lavaroofing.com</a></p>
                    </div>
                </div>
                <div class="recap-footer">
                    <img src="logo.png" alt="LAVA Roofing" style="height: 40px; margin-bottom: 0.5rem; opacity: 0.8;">
                    <p class="tagline">Dependability. Craftsmanship. Aloha.</p>
                    <p class="contact">www.lavaroofing.com | License: CT-39063</p>
                </div>
            `;

            document.getElementById('recapContent').innerHTML = recapHtml;
            showView('recap');
        }

        // Share
        function shareRecap(method) {
            const data = getFormData();

            if (method === 'email') {
                const subject = encodeURIComponent(`LAVA Roofing - Inspection Summary for ${data.customer.address}`);
                const body = encodeURIComponent(`Hi ${data.customer.name},

Thank you for having LAVA Roofing out to inspect your property at ${data.customer.address}.

Please find your inspection summary attached, or view it online.

We'll have a detailed quote ready for you within 2-3 business days.

Questions? Just reply to this email or call us at (808) 280-4090.

Mahalo,
${data.inspectorName || 'LAVA Roofing Team'}

--
LAVA Roofing
Dependability. Craftsmanship. Aloha.
www.lavaroofing.com`);

                window.location.href = `mailto:${data.customer.email}?subject=${subject}&body=${body}`;
            } else if (method === 'print') {
                window.print();
            } else if (method === 'copy') {
                showToast('Share link feature coming soon!');
            }
        }

        // Utilities
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
    </script>
</body>
</html>
